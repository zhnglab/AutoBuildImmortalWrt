#!/bin/sh
# ================== ğŸ§© è‡ªå®šä¹‰ä¸»æœºåä¸SSHæ¬¢è¿è¯­ ==================
# ä½œè€…ï¼šMr.Zhang
# åŠŸèƒ½ï¼š
# 1ï¸âƒ£ è®¾ç½®ä¸»æœºå Mz.WRTï¼ˆç³»ç»Ÿä¸LuCIåŒæ­¥ï¼‰
# 2ï¸âƒ£ SSH ç™»å½•é¡µæ˜¾ç¤ºåŠ¨æ€ç‰ˆæœ¬å·ä¸æ„å»ºæ—¥æœŸï¼ˆåˆ°æœˆï¼‰
# ============================================================

CUSTOM_HOSTNAME="Mz.WRT"
BUILD_DATE=$(date +%Y.%m)

echo "ğŸ§© æ­£åœ¨è®¾ç½®ä¸»æœºåä¸SSHæ¬¢è¿è¯­..."

# ------------------ ä¸»æœºå ------------------
uci set system.@system[0].hostname="${CUSTOM_HOSTNAME}"
uci commit system
echo "${CUSTOM_HOSTNAME}" > /proc/sys/kernel/hostname

# ------------------ åŠ¨æ€è·å–ç³»ç»Ÿç‰ˆæœ¬ ------------------
if [ -f /etc/openwrt_release ]; then
    . /etc/openwrt_release
    FW_VERSION=${DISTRIB_DESCRIPTION:-"ImmortalWrt"}
else
    FW_VERSION="ImmortalWrt"
fi

# ------------------ SSH æ¬¢è¿è¯­ ------------------
BANNER_FILE="/etc/banner"
{
    echo ""
    echo "============================================"
    echo " ğŸ§© ${FW_VERSION}  by Mr.Zhang"
    echo " ğŸ–¥ï¸  Hostname: ${CUSTOM_HOSTNAME}"
    echo " ğŸ“… Build Date: ${BUILD_DATE}"
    echo "============================================"
} >> "$BANNER_FILE"

# ------------------ æ¸…ç† ------------------
rm -f /etc/uci-defaults/99-custom.sh
exit 0
